<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习成长计划</title>
    <style>
        :root {
            --primary-color: #7fc97f;
            --secondary-color: #a8dadc;
            --accent-color: #d3e6d2;
            --highlight-color: #f9c507;
            --background-color: #f8fffe;
            --text-color: #2c3e50;
            --text-light: #5a6c7d;
            --success-color: #51cf66;
            --warning-color: #ff6b6b;
            --shadow: 0 5px 15px rgba(127, 201, 127, 0.2);
        }

        [data-theme="spring"] {
            --primary-color: #7fc97f;
            --secondary-color: #a8dadc;
            --accent-color: #d3e6d2;
            --highlight-color: #f9c507;
            --background-color: #f8fffe;
        }

        [data-theme="blossom"] {
            --primary-color: #e91e63;
            --secondary-color: #f8bbd9;
            --accent-color: #f0b5d5;
            --highlight-color: #ea84a3;
            --background-color: #fefbfc;
        }

        [data-theme="lavender"] {
            --primary-color: #8e44ad;
            --secondary-color: #d8b3e0;
            --accent-color: #af8fd0;
            --highlight-color: #f39c12;
            --background-color: #faf9fe;
        }

        [data-theme="sunset"] {
            --primary-color: #e67e22;
            --secondary-color: #ffd275;
            --accent-color: #f9d580;
            --highlight-color: #3498db;
            --background-color: #fffcf8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
            background: linear-gradient(135deg, var(--background-color) 0%, var(--accent-color) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-color);
            transition: all 0.5s ease;
            font-size: 16px;
            line-height: 1.6;
        }

        .signature {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            color: var(--text-color);
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 1em;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            z-index: 999;
            backdrop-filter: blur(10px);
        }

        .save-buttons {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .save-btn {
            background: var(--success-color);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .load-btn {
            background: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .load-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .auto-save-indicator {
            position: fixed;
            top: 80px;
            left: 20px;
            background: var(--success-color);
            color: white;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 1em;
            z-index: 999;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            transition: all 0.5s ease;
        }

        .theme-selector {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            background: rgba(255,255,255,0.2);
            padding: 8px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .theme-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 3px solid white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-btn:hover {
            transform: scale(1.15);
        }

        .theme-btn.active {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255,255,255,0.8);
        }

        .theme-btn.spring { 
            background: linear-gradient(45deg, #7fc97f, #a8dadc, #d3e6d2, #f9c507);
        }
        .theme-btn.blossom { 
            background: linear-gradient(45deg, #f7cac9, #e8e0f0, #f0b5d5, #ea84a3);
        }
        .theme-btn.lavender { 
            background: linear-gradient(45deg, #9f75ce, #d8b3e0, #af8fd0, #f7df87);
        }
        .theme-btn.sunset { 
            background: linear-gradient(45deg, #fca37c, #ffd275, #f9d580, #7ac7e2);
        }
        
        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
        }
        
        .nav-tabs {
            display: flex;
            background: var(--accent-color);
            transition: all 0.3s ease;
        }
        
        .nav-tab {
            flex: 1;
            padding: 18px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            color: var(--text-color);
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-tab.active {
            background: rgba(255, 255, 255, 0.95);
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .nav-tab:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 35px;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section {
            margin-bottom: 35px;
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid var(--primary-color);
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .section h2 {
            color: var(--primary-color);
            font-size: 2em;
            margin-bottom: 25px;
        }

        .section h3 {
            color: var(--primary-color);
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--text-color);
            font-size: 1.1em;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--accent-color);
            border-radius: 10px;
            font-size: 1.1em;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .task-config-item {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 15px;
            border: 2px solid var(--accent-color);
            border-radius: 10px;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.3s ease;
        }

        .task-config-item:hover {
            border-color: var(--primary-color);
            transform: translateX(5px);
        }
        
        .task-config-item input {
            flex: 1;
            border: none;
            padding: 8px;
            background: transparent;
            font-size: 1.1em;
        }
        
        .task-config-item input[type="number"] {
            width: 70px;
        }
        
        .task-config-item button {
            background: var(--warning-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .task-config-item button:hover {
            background: #ff5252;
            transform: scale(1.05);
        }

        .reward-config-item {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 15px;
            border: 2px solid var(--accent-color);
            border-radius: 10px;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.95);
            transition: all 0.3s ease;
        }

        .reward-config-item:hover {
            border-color: var(--primary-color);
            transform: translateX(5px);
        }
        
        .reward-config-item input {
            flex: 1;
            border: none;
            padding: 8px;
            background: transparent;
            font-size: 1.1em;
        }
        
        .reward-config-item input[type="number"] {
            width: 90px;
        }

        .reward-config-item select {
            border: none;
            background: transparent;
            font-size: 1.1em;
        }

        .checkin-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 25px;
        }
        
        .checkin-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .checkin-panel:hover {
            transform: translateY(-3px);
        }

        .checkin-panel h3 {
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 12px 0;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .task-item:hover {
            transform: translateX(5px);
            border-color: var(--primary-color);
        }
        
        .task-item.completed {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: scale(1.02);
        }
        
        .task-checkbox {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .task-name {
            flex: 1;
            font-weight: 500;
            font-size: 1.1em;
        }
        
        .task-points {
            background: var(--highlight-color);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1em;
            font-weight: bold;
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .completed .task-points {
            background: white;
            color: var(--primary-color);
        }
        
        .score-display {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin-top: 25px;
            transition: all 0.3s ease;
        }

        .score-display:hover {
            transform: translateY(-3px);
        }
        
        .daily-score {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .total-score {
            font-size: 1.8em;
            color: var(--text-light);
            margin-bottom: 25px;
        }

        .progress-ring {
            width: 130px;
            height: 130px;
            margin: 20px auto;
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            fill: none;
            stroke: var(--accent-color);
            stroke-width: 10;
        }
        
        .progress-ring-progress {
            fill: none;
            stroke: var(--primary-color);
            stroke-width: 10;
            stroke-linecap: round;
            transition: all 0.8s ease;
        }
        
        .btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--highlight-color), var(--accent-color));
            color: var(--text-color);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--warning-color), #ff5252);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #40c057);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: var(--text-light);
            font-weight: 500;
            font-size: 1.1em;
        }

        .daily-records {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .daily-records:hover {
            transform: translateY(-3px);
        }
        
        .records-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .records-body {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px;
            border-bottom: 1px solid var(--accent-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }
        
        .record-item:hover {
            background: var(--accent-color);
            transform: translateX(5px);
        }
        
        .record-date {
            font-weight: bold;
            color: var(--text-color);
        }
        
        .record-score {
            font-weight: bold;
            color: var(--primary-color);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .chart-container:hover {
            transform: translateY(-3px);
        }

        .chart-title {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.4em;
        }

        .reward-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }
        
        .reward-table th,
        .reward-table td {
            padding: 18px;
            text-align: left;
            border-bottom: 1px solid var(--accent-color);
            color: var(--text-color);
            font-size: 1.1em;
        }
        
        .reward-table th {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: bold;
        }
        
        .reward-table tr {
            transition: all 0.3s ease;
        }
        
        .reward-table tr:hover {
            background: var(--accent-color);
            transform: scale(1.01);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 18px 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 1000;
            transform: translateX(100%);
            transition: all 0.4s ease;
            max-width: 350px;
            font-size: 1.1em;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success-color);
        }

        .notification.warning {
            background: var(--warning-color);
        }

        .reward-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--highlight-color), var(--primary-color));
            color: var(--text-color);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            transform: translateX(100%);
            transition: all 0.5s ease;
            max-width: 380px;
            border: 3px solid white;
        }
        
        .reward-alert.show {
            transform: translateX(0);
        }
        
        .reward-alert h3 {
            margin-bottom: 12px;
            color: var(--text-color);
            font-size: 1.3em;
        }

        .reward-alert p {
            color: var(--text-light);
            font-size: 1.1em;
        }
        
        .reward-alert .close-btn {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-color);
        }

        .highlight {
            background: rgba(255, 255, 255, 0.9);
            padding: 22px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid var(--primary-color);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            color: var(--text-color);
            backdrop-filter: blur(10px);
            font-size: 1.1em;
        }

        .highlight:hover {
            transform: translateY(-2px);
        }

        .highlight strong {
            color: var(--primary-color);
        }

        .setup-complete {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4caf50;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            color: #2e7d32;
            font-size: 1.2em;
            margin-bottom: 25px;
        }

        .eva-message {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 248, 240, 0.95));
            border: 2px solid var(--highlight-color);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .eva-message::before {
            content: '👩‍🏫';
            position: absolute;
            top: -15px;
            left: 20px;
            background: var(--highlight-color);
            padding: 10px 15px;
            border-radius: 50%;
            font-size: 1.4em;
        }

        .eva-message:hover {
            transform: translateY(-3px);
        }

        .eva-title {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.3em;
            margin-bottom: 15px;
            margin-top: 8px;
        }

        .eva-content {
            color: var(--text-color);
            line-height: 1.7;
            font-size: 1.15em;
        }

        .verification-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .verification-modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            margin: 20px;
        }

        .verification-code {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
            background: var(--accent-color);
            padding: 15px 30px;
            border-radius: 10px;
            margin: 20px 0;
            letter-spacing: 3px;
            font-family: monospace;
        }

        .guide-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid var(--primary-color);
            box-shadow: var(--shadow);
        }

        .guide-section h4 {
            color: var(--primary-color);
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .guide-list {
            list-style: none;
            padding-left: 0;
        }

        .guide-list li {
            padding: 8px 0;
            border-bottom: 1px dashed var(--accent-color);
            font-size: 1.1em;
        }

        .guide-list li:before {
            content: "✓ ";
            color: var(--primary-color);
            font-weight: bold;
            margin-right: 8px;
        }

        .intro-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 255, 254, 0.95));
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .intro-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--highlight-color));
        }

        .intro-card h3 {
            color: var(--primary-color);
            font-size: 1.6em;
            margin-bottom: 20px;
        }

        .intro-card p {
            font-size: 1.15em;
            line-height: 1.7;
            color: var(--text-color);
        }

        .save-notice {
            background: linear-gradient(135deg, rgba(249, 197, 7, 0.1), rgba(255, 255, 255, 0.9));
            border: 2px solid var(--highlight-color);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .save-notice h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .checkin-container {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .tab-content {
                padding: 25px;
            }

            .theme-selector {
                position: static;
                justify-content: center;
                margin-bottom: 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .signature {
                position: static;
                text-align: center;
                margin: 20px 0;
            }

            .save-buttons {
                position: static;
                justify-content: center;
                margin-bottom: 20px;
            }

            body {
                font-size: 15px;
            }

            .verification-modal-content {
                padding: 30px 20px;
            }

            .verification-code {
                font-size: 1.5em;
                padding: 12px 20px;
            }
        }
    </style>
</head>
<body data-theme="spring">
    <!-- 一键保存/加载按钮 -->
    <div class="save-buttons">
        <button class="save-btn" onclick="saveAllDataToFile()" title="一键保存所有数据到文件">💾 一键保存</button>
        <button class="load-btn" onclick="loadDataFromFile()" title="从文件加载数据">📂 加载数据</button>
        <input type="file" id="load-file-input" accept=".json" style="display: none;" onchange="handleFileLoad(this)">
    </div>

    <!-- 署名 -->
    <div class="signature">
        Eva老师👩‍🏫伴步英语
    </div>

    <!-- 自动保存指示器 -->
    <div class="auto-save-indicator" id="auto-save-indicator">
        💾 数据已保存到文件
    </div>

    <!-- 验证码弹窗 -->
    <div class="verification-modal" id="verification-modal">
        <div class="verification-modal-content">
            <h3>🔐 安全验证</h3>
            <p style="margin: 15px 0; font-size: 1.1em;">为了防止误操作，请输入下方显示的验证码：</p>
            <div class="verification-code" id="verification-code">ABCD12</div>
            <input type="text" id="verification-input" placeholder="请输入验证码" style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1.1em; margin: 15px 0; text-align: center; letter-spacing: 2px;">
            <div style="margin-top: 20px;">
                <button class="btn btn-danger" onclick="confirmReset()">确认重置</button>
                <button class="btn btn-secondary" onclick="closeVerificationModal()">取消</button>
            </div>
            <p style="margin-top: 15px; color: #666; font-size: 0.9em;">⚠️ 重置后所有数据将被清空且无法恢复</p>
        </div>
    </div>

    <!-- 奖励提醒弹窗 -->
    <div class="reward-alert" id="reward-alert">
        <button class="close-btn" onclick="closeRewardAlert()">&times;</button>
        <h3 id="reward-title">🎉 恭喜获得奖励！</h3>
        <p id="reward-message">你太棒了！</p>
    </div>

    <div class="container">
        <div class="header">
            <div class="theme-selector">
                <div class="theme-btn spring active" onclick="setTheme('spring')" title="春意盎然"></div>
                <div class="theme-btn blossom" onclick="setTheme('blossom')" title="樱花粉嫩"></div>
                <div class="theme-btn lavender" onclick="setTheme('lavender')" title="薰衣草紫"></div>
                <div class="theme-btn sunset" onclick="setTheme('sunset')" title="夕阳橙黄"></div>
            </div>
            <h1 id="plan-title">🌟 学习成长计划 🌟</h1>
            <p id="plan-subtitle">有目标 有计划 有行动 有成长</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab" onclick="showTab(event, 'guide')" id="guide-tab">📖 使用指南</button>
            <button class="nav-tab" onclick="showTab(event, 'setup')" id="setup-tab">⚙️ 个人设置</button>
            <button class="nav-tab" onclick="showTab(event, 'checkin')" id="checkin-tab" style="display: none;">📝 每日打卡</button>
            <button class="nav-tab" onclick="showTab(event, 'records')" id="records-tab" style="display: none;">📊 进度记录</button>
            <button class="nav-tab" onclick="showTab(event, 'analysis')" id="analysis-tab" style="display: none;">📈 数据分析</button>
            <button class="nav-tab" onclick="showTab(event, 'rewards')" id="rewards-tab" style="display: none;">🏆 奖励系统</button>
            <button class="nav-tab" onclick="showTab(event, 'backup')" id="backup-tab" style="display: none;">💾 数据管理</button>
        </div>
        
        <!-- 使用指南页面 -->
        <div class="tab-content" id="guide">
            <div class="save-notice">
                <h3>📌 重要提示 📌</h3>
                <p>为了确保数据不丢失，请经常点击左上角的"💾 一键保存"按钮！下次打开网页时，点击"📂 加载数据"即可恢复所有数据。😊</p>
            </div>

            <div class="intro-card">
                <h3>🌈 Eva老师的设计初衷</h3>
                <p>亲爱的家长和孩子们 👨‍👩‍👧‍👦，我设计这个学习成长计划的初衷，是希望每个孩子都能在学习中找到乐趣，在成长中收获快乐。我相信<strong>有目标、有计划、有行动、有成长</strong>的学习方式，能让孩子们不仅提升学习成绩，更重要的是培养良好的学习习惯和自我管理能力。🌱✨</p>
            </div>

            <div class="intro-card">
                <h3>🎯 成长联盟的力量</h3>
                <p>亲爱的孩子 🧒，要知道在你成长的路上，爸爸妈妈 👨‍👩‍👧‍👦、老师 👩‍🏫 和你自己是一个强大的"成长联盟"！我们都在用不同的方式支持你、鼓励你。但是，最重要的是<strong>你自己要燃起那颗朝着目标不断前进的心 ❤️‍🔥</strong>！外在的奖励只是帮助你看到自己的进步，真正的动力来自于你内心对成长的渴望和对美好未来的憧憬。🚀🌟</p>
            </div>

            <div class="intro-card">
                <h3>🎮 让成长看得见</h3>
                <p>这个系统采用积分制和阶段性激励，让学习变得可视化、游戏化 🎲。通过每日打卡、进度追踪和数据分析，帮助孩子们看到自己每一天的成长足迹 👣。在真正养成好习惯之前，这些可视化的成果和阶段性的正向激励，能够有效帮助孩子培养持续的学习习惯，就像游戏中的升级系统一样有趣！🎊</p>
            </div>

            <div class="section">
                <h2>📚 详细使用说明</h2>
                
                <div class="guide-section">
                    <h4>💾 超重要：数据保存秘籍 🔐</h4>
                    <ul class="guide-list">
                        <li>使用过程中，记得经常点击左上角"💾 一键保存"按钮 👆</li>
                        <li>保存后会下载一个数据文件到电脑，这是你的学习宝藏 💎</li>
                        <li>下次打开网页时，点击"📂 加载数据"选择之前保存的文件 📁</li>
                        <li>这样就能完美恢复所有学习记录和设置 ✨</li>
                        <li>建议每次使用结束都保存一次，数据安全最重要 🛡️</li>
                    </ul>
                </div>
                
                <div class="guide-section">
                    <h4>🛠️ 第一步：个人专属设置</h4>
                    <ul class="guide-list">
                        <li>输入你的专属姓名和年级信息 📝</li>
                        <li>设置学习计划的时间段（暑假、寒假都可以哦）📅</li>
                        <li>给计划起个酷炫的名字，比如"超级学霸养成计划" 🦸‍♂️</li>
                        <li>设置每日目标分数和终极大目标 🎯</li>
                        <li>自定义学习任务清单（每个任务都有积分奖励）📋</li>
                        <li>添加生活好习惯培养项目 🌱</li>
                        <li>设计专属奖励机制，让努力变得更有盼头 🎁</li>
                    </ul>
                </div>

                <div class="guide-section">
                    <h4>📝 第二步：每日成长打卡</h4>
                    <ul class="guide-list">
                        <li>每天选择当前日期开始你的成长之旅 📆</li>
                        <li>逐一勾选完成的任务，每一个✓都是成长的证明 ✅</li>
                        <li>系统会自动计算今日得分和总战斗力 💪</li>
                        <li>达到目标分数后点击"保存当日进度"记录成果 💾</li>
                        <li>观察进度环的神奇变化，感受每日的蜕变 🔄</li>
                        <li>可以补签之前的日期，但不能穿越到未来哦 ⏰</li>
                    </ul>
                </div>

                <div class="guide-section">
                    <h4>📊 第三步：成长轨迹追踪</h4>
                    <ul class="guide-list">
                        <li>在"进度记录"看到你所有的努力足迹 👣</li>
                        <li>点击任意记录可以时光回溯到那一天 ⏳</li>
                        <li>查看完成天数、平均得分等炫酷数据 📈</li>
                        <li>了解自己的学习完成率和未来预测 🔮</li>
                        <li>通过数据发现自己的学习超能力 🦸‍♀️</li>
                    </ul>
                </div>

                <div class="guide-section">
                    <h4>🤖 第四步：智能分析与建议</h4>
                    <ul class="guide-list">
                        <li>查看学习任务和生活习惯的完成率分析 📊</li>
                        <li>发现自己的"最长连击记录"和周平均战斗力 🔥</li>
                        <li>阅读Eva老师的个性化建议和暖心鼓励 💕</li>
                        <li>根据专业建议优化学习策略和目标设定 🎯</li>
                        <li>持续进化，成为更好的自己 🌟</li>
                    </ul>
                </div>

                <div class="guide-section">
                    <h4>🏆 第五步：成就解锁与庆祝</h4>
                    <ul class="guide-list">
                        <li>在"奖励系统"查看你的成就收集进度 🏅</li>
                        <li>达成条件时会有惊喜弹窗庆祝你的努力 🎉</li>
                        <li>家长要及时兑现承诺，让成就感爆棚 💝</li>
                        <li>可以随时调整奖励内容，保持新鲜感 🆕</li>
                        <li>记住：奖励是成长路上的加油站，不是终点 ⛽</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <h2>💡 成长智慧分享</h2>
                
                <div class="highlight">
                    <strong>💌 给家长的贴心话：</strong>这个工具是孩子养成好习惯的得力助手，但最关键的是您的陪伴和鼓励 🤗。建议每天花几分钟和孩子一起回顾学习情况，给予温暖的反馈。在孩子真正养成好习惯之前，这些可视化的进步和阶段性的正向激励能够有效支持他们建立持续学习的信心。记住要及时兑现奖励承诺，也别忘了经常保存数据哦！💾
                </div>

                <div class="highlight">
                    <strong>🌟 给孩子的鼓励话：</strong>学习就像玩RPG游戏一样，每完成一个任务就能获得经验值，积分越多等级越高！🎮 不要因为某一天的得分低而气馁，真正的勇者知道，不怕慢，就怕停！记住，外在的奖励很棒，但最重要的是你内心那股"我要变得更棒"的火焰 🔥。每一天的努力都是在为未来的自己积攒超能力！💪✨
                </div>

                <div class="highlight">
                    <strong>🔄 成长联盟宣言：</strong>我们是孩子成长路上的同盟军 👥！爸爸妈妈提供爱与支持，老师提供方法与指导，而孩子自己是这场成长冒险的主角 🌟。这个系统不仅适用于假期，也能用于日常学习、期末冲刺、兴趣培养等各种场景。让我们齐心协力，点燃孩子内心的成长火焰！🔥🚀
                </div>
            </div>

            <div class="intro-card">
                <h3>🌈 Eva老师的成长祝福</h3>
                <p>希望通过这个温暖的小工具，能够帮助每个孩子建立起自主学习的超能力和受益终生的好习惯 🦸‍♂️。学习不应该是痛苦的负担，而应该是充满成就感和快乐的成长冒险 🎯！在爸爸妈妈、老师和你自己组成的"成长联盟"支持下，相信每个孩子都能燃起内心的成长火焰，不仅在学习上进步，更重要的是培养出坚韧不拔、积极向上的美好品格！加油，未来的你一定会感谢现在努力的自己！🌟💖</p>
            </div>
        </div>
        
        <!-- 个人设置页面 -->
        <div class="tab-content" id="setup">
            <div class="section">
                <h2>⚙️ 个人信息设置</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="student-name">孩子姓名：</label>
                        <input type="text" id="student-name" placeholder="请输入姓名">
                    </div>
                    <div class="form-group">
                        <label for="student-grade">年级：</label>
                        <select id="student-grade">
                            <option value="">请选择年级</option>
                            <option value="一年级">一年级</option>
                            <option value="二年级">二年级</option>
                            <option value="三年级">三年级</option>
                            <option value="四年级">四年级</option>
                            <option value="五年级">五年级</option>
                            <option value="六年级">六年级</option>
                            <option value="初一">初一</option>
                            <option value="初二">初二</option>
                            <option value="初三">初三</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="plan-name">计划名称：</label>
                    <input type="text" id="plan-name" placeholder="如：暑假学习计划、期末冲刺计划等" value="暑假学习成长计划">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="vacation-start">计划开始日期：</label>
                        <input type="date" id="vacation-start">
                    </div>
                    <div class="form-group">
                        <label for="vacation-end">计划结束日期：</label>
                        <input type="date" id="vacation-end">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="daily-target">每日优秀标准分数：</label>
                        <input type="number" id="daily-target" min="20" max="100" value="35" placeholder="35">
                    </div>
                    <div class="form-group">
                        <label for="final-target">最终目标总分：</label>
                        <input type="number" id="final-target" min="500" max="5000" value="1200" placeholder="1200">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>📚 学习任务设置</h2>
                <div id="study-tasks"></div>
                <button class="btn btn-secondary" onclick="addStudyTask()">+ 添加学习任务</button>
            </div>
            
            <div class="section">
                <h2>💪 生活习惯设置</h2>
                <div id="life-habits"></div>
                <button class="btn btn-secondary" onclick="addLifeHabit()">+ 添加生活习惯</button>
            </div>

            <div class="section">
                <h2>🏆 成长激励设置</h2>
                <div id="reward-items"></div>
                <button class="btn btn-secondary" onclick="addRewardItem()">+ 添加激励项目</button>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-success" onclick="saveSetup()" style="font-size: 1.3em; padding: 18px 35px;">
                    ✅ 保存设置并开始使用
                </button>
            </div>
        </div>
        
        <!-- 每日打卡页面 -->
        <div class="tab-content" id="checkin">
            <div class="section">
                <h2>📝 每日任务打卡</h2>
                
                <div style="text-align: center; margin: 20px 0; padding: 20px; background: rgba(255,255,255,0.9); border-radius: 12px;">
                    <label for="check-date" style="font-size: 1.2em;">选择日期: </label>
                    <input type="date" id="check-date" style="padding: 12px; border: 2px solid var(--primary-color); border-radius: 8px; margin: 0 15px; font-size: 1.1em;">
                    <button class="btn btn-secondary" onclick="setToday()">今天</button>
                    <span style="margin-left: 20px; font-weight: bold; color: var(--primary-color); font-size: 1.2em;" id="current-date-display">今天</span>
                </div>

                <div class="highlight">
                    <strong id="date-goal">今日目标：</strong>完成任务，记录成长足迹！每一个勾选都是向目标迈进的一步！
                </div>
                
                <div class="checkin-container">
                    <div class="checkin-panel">
                        <h3>📚 学习任务</h3>
                        <div id="study-checkin">
                            <!-- 学习任务将在这里动态生成 -->
                        </div>
                    </div>
                    
                    <div class="checkin-panel">
                        <h3>💪 生活习惯</h3>
                        <div id="life-checkin">
                            <!-- 生活习惯将在这里动态生成 -->
                        </div>
                    </div>
                </div>
                
                <div class="score-display">
                    <div class="daily-score">当日得分: <span id="daily-score">0</span>/<span id="max-score">0</span>分</div>
                    <div class="total-score">累计总分: <span id="total-score">0</span>分</div>
                    
                    <svg class="progress-ring">
                        <circle class="progress-ring-circle" cx="65" cy="65" r="55"></circle>
                        <circle class="progress-ring-progress" cx="65" cy="65" r="55" id="progress-circle"></circle>
                    </svg>
                    
                    <div style="margin-top: 25px;">
                        <button class="btn" onclick="saveProgress()">💾 保存当日进度</button>
                        <button class="btn btn-secondary" onclick="resetDaily()">🔄 重置当日</button>
                        <button class="btn btn-danger" onclick="showVerificationModal()">🗑️ 全部重置</button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="completed-days">0</div>
                        <div class="stat-label">完成天数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="average-score">0</div>
                        <div class="stat-label">平均得分</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="streak-days">0</div>
                        <div class="stat-label">连续天数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="target-progress">0%</div>
                        <div class="stat-label">目标进度</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 进度记录页面 -->
        <div class="tab-content" id="records">
            <div class="section">
                <h2>📊 详细进度记录</h2>
                <div class="daily-records">
                    <div class="records-header">
                        每日学习记录 (从开始到现在的所有记录)
                    </div>
                    <div class="records-body" id="records-list"></div>
                </div>
                
                <div class="stats-grid" style="margin-top: 25px;">
                    <div class="stat-card">
                        <div class="stat-number" id="total-days">0</div>
                        <div class="stat-label">计划总天数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="remaining-days">0</div>
                        <div class="stat-label">剩余天数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completion-rate">0%</div>
                        <div class="stat-label">完成率</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="predicted-total">0</div>
                        <div class="stat-label">预测总分</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 数据分析页面 -->
        <div class="tab-content" id="analysis">
            <div class="section">
                <h2>📈 学习数据分析</h2>
                
                <div class="chart-container">
                    <div class="chart-title">学习表现统计</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="study-completion">0%</div>
                            <div class="stat-label">学习任务完成率</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="habit-completion">0%</div>
                            <div class="stat-label">生活习惯完成率</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="best-streak">0</div>
                            <div class="stat-label">最长连续天数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avg-weekly">0</div>
                            <div class="stat-label">周平均得分</div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">👩‍🏫Eva老师对你说：</div>
                    <div id="study-suggestions"></div>
                </div>
            </div>
        </div>

        <!-- 奖励系统页面 -->
        <div class="tab-content" id="rewards">
            <div class="section">
                <h2>🏆 成长激励系统</h2>
                <div class="highlight">
                    <strong>💡 设计理念：</strong>通过可视化的成果展示和阶段性的正向激励，帮助孩子在真正养成好习惯之前保持学习的动力和信心。每一份努力都值得被看见和庆祝！🎉✨
                </div>
                
                <div id="reward-display"></div>
            </div>
        </div>

        <!-- 数据管理页面 -->
        <div class="tab-content" id="backup">
            <div class="section">
                <h2>💾 数据备份与恢复</h2>
                
                <div style="background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                    <h3 style="font-size: 1.3em;">📥 数据导出</h3>
                    <p style="margin: 15px 0; color: var(--text-color); font-size: 1.1em;">将你的学习数据导出备份，防止数据丢失</p>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="exportData()">💾 导出学习数据</button>
                        <button class="btn btn-secondary" onclick="generateReport()">📋 生成学习报告</button>
                    </div>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 12px;">
                    <h3 style="font-size: 1.3em;">📤 数据恢复</h3>
                    <p style="margin: 15px 0; color: var(--text-color); font-size: 1.1em;">从备份文件恢复你的学习数据</p>
                    <div class="form-group">
                        <label for="import-file">选择备份文件：</label>
                        <input type="file" id="import-file" accept=".json" onchange="importData(this)">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局配置和数据
        let config = {
            studentName: '',
            studentGrade: '',
            planName: '暑假学习成长计划',
            vacationStart: '',
            vacationEnd: '',
            dailyTarget: 35,
            finalTarget: 1200,
            studyTasks: [],
            lifeHabits: [],
            rewardItems: [],
            setupComplete: false,
            theme: 'spring'
        };
        
        let dailyScore = 0;
        let totalScore = 0;
        let completedDays = 0;
        let streakDays = 0;
        let dailyRecords = [];
        let currentDate = new Date().toISOString().split('T')[0];
        let achievements = {};
        let currentVerificationCode = '';

        // 一键保存功能 - 保存所有数据到文件
        function saveAllDataToFile() {
            const allData = {
                config: config,
                dailyRecords: dailyRecords,
                totalScore: totalScore,
                completedDays: completedDays,
                streakDays: streakDays,
                achievements: achievements,
                currentDate: currentDate,
                dailyScore: dailyScore,
                saveDate: new Date().toISOString(),
                version: '2.0'
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `学习计划数据_${config.studentName || '未命名'}_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showSaveIndicator();
            showNotification('数据已保存到文件！下次打开时请加载此文件。', 'success');
        }

        // 加载数据文件
        function loadDataFromFile() {
            document.getElementById('load-file-input').click();
        }

        // 处理文件加载
        function handleFileLoad(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const loadedData = JSON.parse(e.target.result);
                    
                    if (!loadedData.config || !loadedData.version) {
                        showNotification('文件格式不正确，请选择正确的数据文件！', 'warning');
                        return;
                    }
                    
                    // 恢复所有数据
                    config = loadedData.config;
                    dailyRecords = loadedData.dailyRecords || [];
                    totalScore = loadedData.totalScore || 0;
                    completedDays = loadedData.completedDays || 0;
                    streakDays = loadedData.streakDays || 0;
                    achievements = loadedData.achievements || {};
                    currentDate = loadedData.currentDate || new Date().toISOString().split('T')[0];
                    dailyScore = loadedData.dailyScore || 0;
                    
                    // 更新界面
                    updatePlanTitle();
                    if (config.theme) {
                        setTheme(config.theme);
                    }
                    
                    // 初始化界面
                    if (config.setupComplete) {
                        showMainApp();
                        loadStoredSetupData();
                        initializeDatePicker();
                        renderCheckinTasks();
                        loadDateData();
                        updateDisplay();
                        renderRewardTable();
                        initializeDefaultTab();
                    } else {
                        initializeSetup();
                        showTab(null, 'guide');
                    }
                    
                    showNotification(`数据加载成功！欢迎回来，${config.studentName || '同学'}！`, 'success');
                    
                } catch (error) {
                    console.error('数据加载失败:', error);
                    showNotification('文件格式错误，无法加载数据！', 'warning');
                }
            };
            reader.readAsText(file);
            
            // 清空文件输入，允许重复选择同一文件
            input.value = '';
        }

        // 显示保存指示器
        function showSaveIndicator() {
            const indicator = document.getElementById('auto-save-indicator');
            if (indicator) {
                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 3000);
            }
        }

        // 生成随机验证码
        function generateVerificationCode() {
            const chars = 'ABCDEFGHIJKLMNPQRSTUVWXYZ123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // 显示验证码弹窗
        function showVerificationModal() {
            currentVerificationCode = generateVerificationCode();
            document.getElementById('verification-code').textContent = currentVerificationCode;
            document.getElementById('verification-input').value = '';
            document.getElementById('verification-modal').style.display = 'flex';
            document.getElementById('verification-input').focus();
        }

        // 关闭验证码弹窗
        function closeVerificationModal() {
            document.getElementById('verification-modal').style.display = 'none';
            currentVerificationCode = '';
        }

        // 确认重置
        function confirmReset() {
            const inputCode = document.getElementById('verification-input').value.toUpperCase();
            if (inputCode === currentVerificationCode) {
                if (confirm('确定要重置所有数据吗？此操作不可恢复！')) {
                    resetAllData();
                    closeVerificationModal();
                }
            } else {
                showNotification('验证码错误，请重新输入！', 'warning');
                document.getElementById('verification-input').value = '';
                document.getElementById('verification-input').focus();
            }
        }

        // 重置所有数据
        function resetAllData() {
            config = {
                studentName: '',
                studentGrade: '',
                planName: '暑假学习成长计划',
                vacationStart: '',
                vacationEnd: '',
                dailyTarget: 35,
                finalTarget: 1200,
                studyTasks: [],
                lifeHabits: [],
                rewardItems: [],
                setupComplete: false,
                theme: 'spring'
            };
            
            dailyScore = 0;
            totalScore = 0;
            completedDays = 0;
            streakDays = 0;
            dailyRecords = [];
            achievements = {};
            
            showNotification('所有数据已重置，即将刷新页面', 'success');
            setTimeout(() => location.reload(), 1000);
        }

        // 键盘事件监听
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('verification-modal').style.display === 'flex') {
                confirmReset();
            }
        });

        // 通知系统
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // 主题系统
        function setTheme(themeName) {
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelector(`.theme-btn.${themeName}`).classList.add('active');
            
            config.theme = themeName;
            document.body.setAttribute('data-theme', themeName);
            showNotification(`已切换主题`, 'success');
        }

        // 奖励系统
        function checkAndShowRewards() {
            config.rewardItems.forEach(item => {
                const achievementKey = `${item.name}_${item.target}`;
                
                let shouldShow = false;
                if (item.type === 'daily' && dailyScore >= item.target && !achievements[achievementKey]) {
                    shouldShow = true;
                } else if (item.type === 'total' && totalScore >= item.target && !achievements[achievementKey]) {
                    shouldShow = true;
                }
                
                if (shouldShow) {
                    showRewardAlert(item.name, `恭喜！你获得了"${item.reward}"！`);
                    achievements[achievementKey] = true;
                }
            });
        }
        
        function showRewardAlert(title, message) {
            const alertEl = document.getElementById('reward-alert');
            const titleEl = document.getElementById('reward-title');
            const messageEl = document.getElementById('reward-message');
            
            if (titleEl) titleEl.textContent = title;
            if (messageEl) messageEl.textContent = message;
            if (alertEl) alertEl.classList.add('show');
            
            setTimeout(() => {
                closeRewardAlert();
            }, 5000);
        }
        
        function closeRewardAlert() {
            const alertEl = document.getElementById('reward-alert');
            if (alertEl) alertEl.classList.remove('show');
        }

        function renderRewardTable() {
            const container = document.getElementById('reward-display');
            if (!container) return;
            
            let tableHTML = `
                <table class="reward-table">
                    <thead>
                        <tr>
                            <th>激励名称</th>
                            <th>达成条件</th>
                            <th>激励内容</th>
                            <th>目标要求</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            config.rewardItems.forEach((item, index) => {
                let status = '❌ 未达成';
                if (item.type === 'daily' && dailyScore >= item.target) {
                    status = '✅ 已达成';
                } else if (item.type === 'total' && totalScore >= item.target) {
                    status = '✅ 已达成';
                } else if (item.type === 'weekly') {
                    const recentDays = dailyRecords.slice(-7);
                    const weeklyStars = recentDays.filter(day => day.score >= config.dailyTarget).length;
                    status = weeklyStars >= item.target ? '✅ 已达成' : `❌ 本周${weeklyStars}/${item.target}天`;
                }
                
                tableHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.condition}</td>
                        <td>${item.reward}</td>
                        <td>${item.target}${item.type === 'daily' ? '分/天' : item.type === 'weekly' ? '天/周' : '分'}</td>
                        <td>${status}</td>
                    </tr>
                `;
            });
            
            tableHTML += `</tbody></table>`;
            container.innerHTML = tableHTML;
        }

        // Eva老师的智能建议系统
        function generateSuggestions() {
            const container = document.getElementById('study-suggestions');
            if (!container) return;
            
            const suggestion = getLatestEvaAdvice();
            
            container.innerHTML = `
                <div class="eva-message">
                    <div class="eva-title">Eva老师的话：</div>
                    <div class="eva-content">${suggestion}</div>
                </div>
            `;
        }

        function getLatestEvaAdvice() {
            const studentName = config.studentName || '孩子';
            
            if (dailyRecords.length === 0) {
                return `${studentName}，开始学习之旅的第一步最重要！每天坚持一点点，你会看到自己的进步。记住，不怕慢，就怕停！记得经常保存数据哦！✨`;
            }
            
            const recentDays = dailyRecords.slice(-7);
            const avgScore = recentDays.length > 0 ? recentDays.reduce((sum, day) => sum + day.score, 0) / recentDays.length : 0;
            const progress = (totalScore / config.finalTarget) * 100;
            
            if (streakDays >= 14) {
                return `${studentName}，你已经连续坚持${streakDays}天了！这种毅力让老师刮目相看！好习惯正在你身上生根发芽，继续保持这个超棒的节奏！🏆`;
            } else if (progress >= 90) {
                return `${studentName}，你距离最终目标只有一步之遥了！这个学习计划的努力即将收获满满的成果。最后的冲刺阶段，加油！🚀`;
            } else if (avgScore >= config.dailyTarget * 1.2) {
                return `${studentName}，你的表现超出了预期目标！这种优秀的状态让老师为你骄傲。要记得劳逸结合，保持身心健康哦！🎯`;
            } else if (streakDays >= 7) {
                return `${studentName}，连续一周的坚持，你已经迈过了最难的第一关！现在让我们挑战两周连续打卡，相信你一定能做到！💪`;
            } else if (progress >= 75) {
                return `${studentName}，你已经完成了四分之三的目标！看到自己这么大的进步，是不是很有成就感？继续保持，胜利就在前方！🎊`;
            } else if (avgScore >= config.dailyTarget) {
                return `${studentName}，你的表现很稳定，一直保持在优秀水平！这种稳扎稳打的学习方式最棒了。试试看能不能在某些方面再提升一点点？📈`;
            } else if (streakDays >= 3) {
                return `${studentName}，三天的坚持是个很好的开始！现在是养成习惯的关键期，再坚持4天就能完成一周挑战啦！🌟`;
            } else if (progress >= 50) {
                return `${studentName}，恭喜你已经完成了一半的目标！这是一个重要的里程碑。现在你有经验了，后面的路会越走越顺的！🌸`;
            } else if (avgScore >= config.dailyTarget * 0.8) {
                return `${studentName}，你已经做得很不错了！离目标只差一点点。试着调整一下学习方法，或者减少一些难度，重要的是保持学习的乐趣！🎈`;
            } else {
                const encouragements = [
                    `${studentName}，学习就像种花一样，需要耐心浇水施肥，总有一天会开出美丽的花朵。你现在做的每一件事都有意义！🌺`,
                    `${studentName}，今天的你比昨天更优秀，明天的你会比今天更出色！每一天都是新的可能！🌅`,
                    `${studentName}，不要小看每天的小进步，积少成多，你会创造出让自己惊喜的成果！坚持就是胜利！🏅`,
                    `${studentName}，学习是一个循序渐进的过程，不要因为分数而气馁。让我们先从完成一半的任务开始，慢慢找回学习的信心！🌈`
                ];
                return encouragements[Math.floor(Math.random() * encouragements.length)];
            }
        }

        function updateAnalysisData() {
            let bestStreak = 0;
            let currentStreakCount = 0;
            
            dailyRecords.forEach(record => {
                if (record.score >= config.dailyTarget) {
                    currentStreakCount++;
                    bestStreak = Math.max(bestStreak, currentStreakCount);
                } else {
                    currentStreakCount = 0;
                }
            });
            
            const recentWeek = dailyRecords.slice(-7);
            const weeklyAvg = recentWeek.length > 0 ? 
                Math.round(recentWeek.reduce((sum, day) => sum + day.score, 0) / recentWeek.length) : 0;
            
            let studyCompleted = 0;
            let habitCompleted = 0;
            
            dailyRecords.forEach(record => {
                if (record.tasks) {
                    Object.keys(record.tasks).forEach(taskId => {
                        if (record.tasks[taskId]) {
                            if (taskId.startsWith('study-')) {
                                studyCompleted++;
                            } else if (taskId.startsWith('life-')) {
                                habitCompleted++;
                            }
                        }
                    });
                }
            });
            
            const studyCompletion = config.studyTasks.length > 0 && dailyRecords.length > 0 ? 
                Math.round((studyCompleted / (config.studyTasks.length * dailyRecords.length)) * 100) : 0;
            const habitCompletion = config.lifeHabits.length > 0 && dailyRecords.length > 0 ? 
                Math.round((habitCompleted / (config.lifeHabits.length * dailyRecords.length)) * 100) : 0;
            
            updateElementSafe('study-completion', studyCompletion + '%');
            updateElementSafe('habit-completion', habitCompletion + '%');
            updateElementSafe('best-streak', bestStreak);
            updateElementSafe('avg-weekly', weeklyAvg);
        }

        function updateElementSafe(id, value) {
            const element = document.getElementById(id);
            if (element) element.textContent = value;
        }
        
        function initializeDefaultTab() {
            if (config.setupComplete) {
                showTab(null, 'checkin');
            } else {
                showTab(null, 'guide');
            }
        }
        
        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化默认配置
            initializeSetup();
            
            // 设置主题
            if (config.theme) {
                setTheme(config.theme);
            }

            updatePlanTitle();
            initializeDefaultTab();
            
            // 显示欢迎提示
            setTimeout(() => {
                showNotification('欢迎使用学习成长计划！记得经常保存数据哦！', 'success');
            }, 1000);
        });

        function updatePlanTitle() {
            if (config.planName && config.studentName) {
                document.getElementById('plan-title').textContent = `🌟 ${config.studentName}的${config.planName} 🌟`;
            } else if (config.planName) {
                document.getElementById('plan-title').textContent = `🌟 ${config.planName} 🌟`;
            }

            if (config.vacationStart && config.vacationEnd && config.studentGrade) {
                document.getElementById('plan-subtitle').textContent = `${config.vacationStart} - ${config.vacationEnd} | ${config.studentGrade}`;
            }
        }

        function loadStoredSetupData() {
            if (config.studentName) document.getElementById('student-name').value = config.studentName;
            if (config.studentGrade) document.getElementById('student-grade').value = config.studentGrade;
            if (config.planName) document.getElementById('plan-name').value = config.planName;
            if (config.vacationStart) document.getElementById('vacation-start').value = config.vacationStart;
            if (config.vacationEnd) document.getElementById('vacation-end').value = config.vacationEnd;
            if (config.dailyTarget) document.getElementById('daily-target').value = config.dailyTarget;
            if (config.finalTarget) document.getElementById('final-target').value = config.finalTarget;
        }
        
        function initializeSetup() {
            config.studyTasks = [
                { name: '语文学习 (60分钟)', points: 8 },
                { name: '数学学习 (60分钟)', points: 8 },
                { name: '英语学习 (45分钟)', points: 8 },
                { name: '作业完成', points: 5 },
                { name: '课外阅读 (30分钟)', points: 4 }
            ];
            
            config.lifeHabits = [
                { name: '体育运动 (60分钟)', points: 5 },
                { name: '每日总结反思', points: 3 },
                { name: '家务劳动', points: 2 },
                { name: '保证8小时睡眠', points: 4 },
                { name: '自定义好习惯', points: 3 }
            ];

            config.rewardItems = [
                { name: '🌟 每日之星', condition: '单日积分≥35分', reward: '小零食 或 娱乐时间30分钟', target: 35, type: 'daily' },
                { name: '🏅 周冠军', condition: '一周5天达到每日之星', reward: '选择一本书籍 或 小玩具', target: 5, type: 'weekly' },
                { name: '🎯 阶段激励', condition: '累计600分 (半程)', reward: '外出游玩 或 特殊活动', target: 600, type: 'total' },
                { name: '👑 终极成就', condition: '累计1200分', reward: '🎮 心仪的奖品', target: 1200, type: 'total' },
                { name: '💎 超级成就', condition: '累计1500分', reward: '额外奖品 + 特别激励', target: 1500, type: 'total' }
            ];
            
            renderSetupForms();
        }
        
        function renderSetupForms() {
            renderStudyTasks();
            renderLifeHabits();
            renderRewardItems();
        }
        
        function renderStudyTasks() {
            const container = document.getElementById('study-tasks');
            if (!container) return;
            
            container.innerHTML = '';
            
            config.studyTasks.forEach((task, index) => {
                const taskDiv = document.createElement('div');
                taskDiv.className = 'task-config-item';
                taskDiv.innerHTML = `
                    <input type="text" value="${task.name}" onchange="updateStudyTask(${index}, 'name', this.value)" placeholder="任务名称">
                    <input type="number" value="${task.points}" min="1" max="20" onchange="updateStudyTask(${index}, 'points', this.value)" title="积分">
                    <span>分</span>
                    <button onclick="removeStudyTask(${index})">删除</button>
                `;
                container.appendChild(taskDiv);
            });
        }
        
        function renderLifeHabits() {
            const container = document.getElementById('life-habits');
            if (!container) return;
            
            container.innerHTML = '';
            
            config.lifeHabits.forEach((habit, index) => {
                const habitDiv = document.createElement('div');
                habitDiv.className = 'task-config-item';
                habitDiv.innerHTML = `
                    <input type="text" value="${habit.name}" onchange="updateLifeHabit(${index}, 'name', this.value)" placeholder="习惯名称">
                    <input type="number" value="${habit.points}" min="1" max="20" onchange="updateLifeHabit(${index}, 'points', this.value)" title="积分">
                    <span>分</span>
                    <button onclick="removeLifeHabit(${index})">删除</button>
                `;
                container.appendChild(habitDiv);
            });
        }

        function renderRewardItems() {
            const container = document.getElementById('reward-items');
            if (!container) return;
            
            container.innerHTML = '';
            
            config.rewardItems.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'reward-config-item';
                itemDiv.innerHTML = `
                    <input type="text" value="${item.name}" onchange="updateRewardItem(${index}, 'name', this.value)" placeholder="激励名称">
                    <input type="text" value="${item.condition}" onchange="updateRewardItem(${index}, 'condition', this.value)" placeholder="达成条件">
                    <input type="text" value="${item.reward}" onchange="updateRewardItem(${index}, 'reward', this.value)" placeholder="激励内容">
                    <input type="number" value="${item.target}" min="1" onchange="updateRewardItem(${index}, 'target', this.value)" placeholder="目标分数">
                    <select onchange="updateRewardItem(${index}, 'type', this.value)">
                        <option value="daily" ${item.type === 'daily' ? 'selected' : ''}>每日</option>
                        <option value="weekly" ${item.type === 'weekly' ? 'selected' : ''}>每周</option>
                        <option value="total" ${item.type === 'total' ? 'selected' : ''}>累计</option>
                    </select>
                    <button onclick="removeRewardItem(${index})">删除</button>
                `;
                container.appendChild(itemDiv);
            });
        }
        
        function addStudyTask() {
            config.studyTasks.push({ name: '新任务', points: 5 });
            renderStudyTasks();
        }
        
        function addLifeHabit() {
            config.lifeHabits.push({ name: '新习惯', points: 3 });
            renderLifeHabits();
        }

        function addRewardItem() {
            config.rewardItems.push({ 
                name: '新激励', 
                condition: '条件', 
                reward: '激励内容', 
                target: 100, 
                type: 'total' 
            });
            renderRewardItems();
        }
        
        function updateStudyTask(index, field, value) {
            if (field === 'points') {
                value = parseInt(value) || 1;
            }
            config.studyTasks[index][field] = value;
        }
        
        function updateLifeHabit(index, field, value) {
            if (field === 'points') {
                value = parseInt(value) || 1;
            }
            config.lifeHabits[index][field] = value;
        }

        function updateRewardItem(index, field, value) {
            if (field === 'target') {
                value = parseInt(value) || 1;
            }
            config.rewardItems[index][field] = value;
        }
        
        function removeStudyTask(index) {
            if (confirm('确定要删除这个学习任务吗？')) {
                config.studyTasks.splice(index, 1);
                renderStudyTasks();
            }
        }
        
        function removeLifeHabit(index) {
            if (confirm('确定要删除这个生活习惯吗？')) {
                config.lifeHabits.splice(index, 1);
                renderLifeHabits();
            }
        }

        function removeRewardItem(index) {
            if (confirm('确定要删除这个激励项目吗？')) {
                config.rewardItems.splice(index, 1);
                renderRewardItems();
            }
        }
        
        function saveSetup() {
            config.studentName = document.getElementById('student-name').value.trim();
            config.studentGrade = document.getElementById('student-grade').value;
            config.planName = document.getElementById('plan-name').value.trim() || '学习成长计划';
            config.vacationStart = document.getElementById('vacation-start').value;
            config.vacationEnd = document.getElementById('vacation-end').value;
            config.dailyTarget = parseInt(document.getElementById('daily-target').value) || 35;
            config.finalTarget = parseInt(document.getElementById('final-target').value) || 1200;
            
            if (!config.studentName) {
                showNotification('请输入孩子的姓名！', 'warning');
                return;
            }
            
            if (!config.studentGrade) {
                showNotification('请选择年级！', 'warning');
                return;
            }
            
            if (!config.vacationStart || !config.vacationEnd) {
                showNotification('请选择计划的开始和结束日期！', 'warning');
                return;
            }
            
            if (new Date(config.vacationStart) >= new Date(config.vacationEnd)) {
                showNotification('结束日期必须晚于开始日期！', 'warning');
                return;
            }
            
            if (config.studyTasks.length === 0) {
                showNotification('请至少添加一个学习任务！', 'warning');
                return;
            }
            
            if (config.lifeHabits.length === 0) {
                showNotification('请至少添加一个生活习惯！', 'warning');
                return;
            }
            
            config.setupComplete = true;
            
            updatePlanTitle();
            
            showNotification('设置保存成功！别忘了点击"一键保存"保存数据哦！', 'success');
            
            const setupSection = document.querySelector('#setup');
            setupSection.innerHTML = `
                <div class="setup-complete">
                    ✅ 个人设置已完成！如需修改设置，请点击下方按钮。
                </div>
                <div style="text-align: center;">
                    <button class="btn btn-secondary" onclick="editSetup()">修改设置</button>
                </div>
            `;
            
            setTimeout(() => {
                showMainApp();
                initializeDatePicker();
                renderCheckinTasks();
                renderRewardTable();
            }, 1000);
        }

        function editSetup() {
            config.setupComplete = false;
            
            const setupSection = document.querySelector('#setup');
            setupSection.innerHTML = `
                <div class="section">
                    <h2>⚙️ 个人信息设置</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="student-name">孩子姓名：</label>
                            <input type="text" id="student-name" placeholder="请输入姓名">
                        </div>
                        <div class="form-group">
                            <label for="student-grade">年级：</label>
                            <select id="student-grade">
                                <option value="">请选择年级</option>
                                <option value="一年级">一年级</option>
                                <option value="二年级">二年级</option>
                                <option value="三年级">三年级</option>
                                <option value="四年级">四年级</option>
                                <option value="五年级">五年级</option>
                                <option value="六年级">六年级</option>
                                <option value="初一">初一</option>
                                <option value="初二">初二</option>
                                <option value="初三">初三</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="plan-name">计划名称：</label>
                        <input type="text" id="plan-name" placeholder="如：暑假学习计划、期末冲刺计划等" value="暑假学习成长计划">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vacation-start">计划开始日期：</label>
                            <input type="date" id="vacation-start">
                        </div>
                        <div class="form-group">
                            <label for="vacation-end">计划结束日期：</label>
                            <input type="date" id="vacation-end">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="daily-target">每日优秀标准分数：</label>
                            <input type="number" id="daily-target" min="20" max="100" value="35" placeholder="35">
                        </div>
                        <div class="form-group">
                            <label for="final-target">最终目标总分：</label>
                            <input type="number" id="final-target" min="500" max="5000" value="1200" placeholder="1200">
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>📚 学习任务设置</h2>
                    <div id="study-tasks"></div>
                    <button class="btn btn-secondary" onclick="addStudyTask()">+ 添加学习任务</button>
                </div>
                
                <div class="section">
                    <h2>💪 生活习惯设置</h2>
                    <div id="life-habits"></div>
                    <button class="btn btn-secondary" onclick="addLifeHabit()">+ 添加生活习惯</button>
                </div>

                <div class="section">
                    <h2>🏆 成长激励设置</h2>
                    <div id="reward-items"></div>
                    <button class="btn btn-secondary" onclick="addRewardItem()">+ 添加激励项目</button>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-success" onclick="saveSetup()" style="font-size: 1.3em; padding: 18px 35px;">
                        ✅ 保存设置并开始使用
                    </button>
                </div>
            `;
            
            initializeSetup();
            loadStoredSetupData();
            showNotification('已进入修改模式，可以修改所有设置', 'success');
        }
        
        function showMainApp() {
            document.getElementById('checkin-tab').style.display = 'block';
            document.getElementById('records-tab').style.display = 'block';
            document.getElementById('analysis-tab').style.display = 'block';
            document.getElementById('rewards-tab').style.display = 'block';
            document.getElementById('backup-tab').style.display = 'block';
            
            updatePlanTitle();
            showTab(null, 'checkin');
        }
        
        function renderCheckinTasks() {
            const studyContainer = document.getElementById('study-checkin');
            const lifeContainer = document.getElementById('life-checkin');
            
            if (!studyContainer || !lifeContainer) {
                return;
            }
            
            studyContainer.innerHTML = '';
            lifeContainer.innerHTML = '';
            
            if (config.studyTasks.length === 0 && config.lifeHabits.length === 0) {
                studyContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">请先在个人设置中添加学习任务</div>';
                lifeContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">请先在个人设置中添加生活习惯</div>';
                return;
            }
            
            config.studyTasks.forEach((task, index) => {
                const taskDiv = document.createElement('div');
                taskDiv.className = 'task-item';
                taskDiv.dataset.points = task.points;
                taskDiv.innerHTML = `
                    <input type="checkbox" class="task-checkbox" id="study-${index}" onchange="onTaskChange()">
                    <span class="task-name">${task.name}</span>
                    <span class="task-points">${task.points}分</span>
                `;
                studyContainer.appendChild(taskDiv);
            });
            
            config.lifeHabits.forEach((habit, index) => {
                const habitDiv = document.createElement('div');
                habitDiv.className = 'task-item';
                habitDiv.dataset.points = habit.points;
                habitDiv.innerHTML = `
                    <input type="checkbox" class="task-checkbox" id="life-${index}" onchange="onTaskChange()">
                    <span class="task-name">${habit.name}</span>
                    <span class="task-points">${habit.points}分</span>
                `;
                lifeContainer.appendChild(habitDiv);
            });
            
            const maxScore = [...config.studyTasks, ...config.lifeHabits].reduce((sum, item) => sum + item.points, 0);
            const maxScoreEl = document.getElementById('max-score');
            if (maxScoreEl) {
                maxScoreEl.textContent = maxScore;
            }
        }

        function onTaskChange() {
            const checkbox = event.target;
            const taskItem = checkbox.parentElement;
            
            if (checkbox.checked) {
                taskItem.classList.add('completed');
            } else {
                taskItem.classList.remove('completed');
            }
            
            calculateDailyScore();
            updateDisplay();
        }
        
        function initializeDatePicker() {
            const dateInput = document.getElementById('check-date');
            if (!dateInput) return;
            
            if (config.vacationStart && config.vacationEnd) {
                dateInput.min = config.vacationStart;
                dateInput.max = config.vacationEnd;
            } else {
                dateInput.removeAttribute('min');
                dateInput.removeAttribute('max');
            }
            
            if (config.vacationStart && config.vacationEnd) {
                const currentDateObj = new Date(currentDate);
                const startDateObj = new Date(config.vacationStart);
                const endDateObj = new Date(config.vacationEnd);
                
                if (currentDateObj < startDateObj) {
                    currentDate = config.vacationStart;
                } else if (currentDateObj > endDateObj) {
                    currentDate = config.vacationEnd;
                }
            }
            
            dateInput.value = currentDate;
            dateInput.removeEventListener('change', handleDateChange);
            dateInput.addEventListener('change', handleDateChange);
            updateDateDisplay();
        }
        
        function handleDateChange(event) {
            currentDate = event.target.value;
            updateDateDisplay();
            loadDateData();
        }
        
        function updateDateDisplay() {
            const selectedDate = new Date(currentDate);
            const today = new Date();
            const dateDisplay = document.getElementById('current-date-display');
            const dateGoal = document.getElementById('date-goal');
            
            if (!dateDisplay || !dateGoal) return;
            
            if (currentDate === today.toISOString().split('T')[0]) {
                dateDisplay.textContent = '今天';
                dateGoal.textContent = '今日目标：';
            } else if (selectedDate < today) {
                dateDisplay.textContent = `补打卡 - ${selectedDate.toLocaleDateString('zh-CN')}`;
                dateGoal.textContent = '补打卡目标：';
            } else {
                dateDisplay.textContent = `未来 - ${selectedDate.toLocaleDateString('zh-CN')}`;
                dateGoal.textContent = '未来目标：';
            }
        }
        
        function setToday() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('check-date');
            if (dateInput) dateInput.value = today;
            currentDate = today;
            updateDateDisplay();
            loadDateData();
        }
        
        function loadDateData() {
            const dateRecord = dailyRecords.find(record => record.date === currentDate);
            
            const checkboxes = document.querySelectorAll('.task-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.parentElement.classList.remove('completed');
            });
            
            if (dateRecord && dateRecord.tasks) {
                Object.keys(dateRecord.tasks).forEach(taskId => {
                    const checkbox = document.getElementById(taskId);
                    if (checkbox && dateRecord.tasks[taskId]) {
                        checkbox.checked = true;
                        checkbox.parentElement.classList.add('completed');
                    }
                });
            }
            
            calculateDailyScore();
            updateDisplay();
        }
        
        function calculateDailyScore() {
            dailyScore = 0;
            const checkboxes = document.querySelectorAll('.task-checkbox:checked');
            checkboxes.forEach(checkbox => {
                const points = parseInt(checkbox.parentElement.dataset.points) || 0;
                dailyScore += points;
            });
        }
        
        function updateDisplay() {
            updateElementSafe('daily-score', dailyScore);
            updateElementSafe('total-score', totalScore);
            updateElementSafe('completed-days', completedDays);
            updateElementSafe('average-score', completedDays > 0 ? Math.round(totalScore / completedDays) : 0);
            updateElementSafe('streak-days', streakDays);
            updateElementSafe('target-progress', Math.round((totalScore / config.finalTarget) * 100) + '%');
            
            const maxScore = parseInt(document.getElementById('max-score')?.textContent || '50');
            const progressPercent = maxScore > 0 ? (dailyScore / maxScore) * 100 : 0;
            const circumference = 2 * Math.PI * 55;
            const progressOffset = circumference - (progressPercent / 100) * circumference;
            const progressCircle = document.getElementById('progress-circle');
            if (progressCircle) {
                progressCircle.style.strokeDasharray = circumference;
                progressCircle.style.strokeDashoffset = progressOffset;
            }
            
            updateStats();
        }
        
        function updateStats() {
            if (!config.vacationStart || !config.vacationEnd) return;
            
            const vacationStart = new Date(config.vacationStart);
            const vacationEnd = new Date(config.vacationEnd);
            const today = new Date();
            const totalDays = Math.ceil((vacationEnd - vacationStart) / (1000 * 60 * 60 * 24)) + 1;
            const remainingDays = Math.max(0, Math.ceil((vacationEnd - today) / (1000 * 60 * 60 * 24)));
            const completionRate = totalDays > 0 ? Math.round((completedDays / totalDays) * 100) : 0;
            const avgScore = completedDays > 0 ? Math.round(totalScore / completedDays) : 0;
            const predictedTotal = avgScore * totalDays;
            
            updateElementSafe('total-days', totalDays);
            updateElementSafe('remaining-days', remainingDays);
            updateElementSafe('completion-rate', completionRate + '%');
            updateElementSafe('predicted-total', predictedTotal);
        }
        
        function updateRecords() {
            const recordsList = document.getElementById('records-list');
            if (!recordsList) return;
            
            recordsList.innerHTML = '';
            
            if (dailyRecords.length === 0) {
                recordsList.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">还没有记录，开始你的第一天吧！</div>';
                return;
            }
            
            let runningTotal = 0;
            dailyRecords.forEach((record, index) => {
                runningTotal += record.score;
                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';
                
                if (record.date === currentDate) {
                    recordItem.style.background = 'var(--highlight-color)';
                    recordItem.style.fontWeight = 'bold';
                }
                
                recordItem.innerHTML = `
                    <span class="record-date">第${index + 1}天 - ${record.date}</span>
                    <span class="record-score">${record.score}分</span>
                    <span style="color: #666; font-size: 0.9em;">累计: ${runningTotal}分</span>
                `;
                
                recordItem.addEventListener('click', () => {
                    currentDate = record.date;
                    const dateInput = document.getElementById('check-date');
                    if (dateInput) dateInput.value = currentDate;
                    updateDateDisplay();
                    loadDateData();
                    showTab(null, 'checkin');
                });
                
                recordsList.appendChild(recordItem);
            });
        }
        
        function saveProgress() {
            const selectedDate = new Date(currentDate);
            const today = new Date();
            
            if (selectedDate > today) {
                showNotification('不能为未来日期保存进度哦！', 'warning');
                return;
            }
            
            if (dailyScore < config.dailyTarget) {
                showNotification(`得分不足${config.dailyTarget}分，无法保存为完成日。当前：${dailyScore}分`, 'warning');
                return;
            }
            
            const tasks = {};
            const checkboxes = document.querySelectorAll('.task-checkbox');
            checkboxes.forEach(checkbox => {
                tasks[checkbox.id] = checkbox.checked;
            });
            
            const existingRecordIndex = dailyRecords.findIndex(record => record.date === currentDate);
            
            if (existingRecordIndex >= 0) {
                const oldScore = dailyRecords[existingRecordIndex].score;
                dailyRecords[existingRecordIndex] = {
                    date: currentDate,
                    score: dailyScore,
                    tasks: tasks
                };
                totalScore = totalScore - oldScore + dailyScore;
                showNotification('当日进度已更新！记得保存数据哦！', 'success');
            } else {
                dailyRecords.push({
                    date: currentDate,
                    score: dailyScore,
                    tasks: tasks
                });
                
                dailyRecords.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                totalScore += dailyScore;
                completedDays++;
                
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                const lastRecord = dailyRecords[dailyRecords.length - 2];
                if (lastRecord && lastRecord.date === yesterday) {
                    streakDays++;
                } else {
                    streakDays = 1;
                }
                
                showNotification(`🎉 进度已保存！总分：${totalScore}分 记得保存数据！`, 'success');
            }
            
            checkAndShowRewards();
            updateDisplay();
            updateRecords();
            renderRewardTable();
        }
        
        function resetDaily() {
            if (confirm('确定要重置当前日期的进度吗？')) {
                dailyScore = 0;
                const checkboxes = document.querySelectorAll('.task-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    checkbox.parentElement.classList.remove('completed');
                });
                updateDisplay();
                showNotification('当日进度已重置', 'success');
            }
        }
        
        function showTab(event, tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const tabButtons = document.querySelectorAll('.nav-tab');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            
            const targetButton = event ? event.target : document.querySelector(`[onclick*="${tabName}"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }
            
            if (tabName === 'records') {
                updateRecords();
            } else if (tabName === 'analysis') {
                setTimeout(() => {
                    updateAnalysisData();
                    generateSuggestions();
                }, 100);
            } else if (tabName === 'rewards') {
                renderRewardTable();
            } else if (tabName === 'checkin') {
                setTimeout(() => {
                    renderCheckinTasks();
                    loadDateData();
                }, 100);
            }
        }

        function exportData() {
            const exportData = {
                config: config,
                dailyRecords: dailyRecords,
                totalScore: totalScore,
                completedDays: completedDays,
                streakDays: streakDays,
                achievements: achievements,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `学习计划备份_${config.studentName || '未命名'}_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('数据导出成功！', 'success');
        }

        function generateReport() {
            const avgScore = completedDays > 0 ? Math.round(totalScore / completedDays) : 0;
            const totalDays = config.vacationStart && config.vacationEnd ? 
                Math.ceil((new Date(config.vacationEnd) - new Date(config.vacationStart)) / (1000 * 60 * 60 * 24)) + 1 : 43;
            const completionRate = Math.round((completedDays / totalDays) * 100);
            
            const report = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>${config.studentName}的学习报告</title>
                <style>
                    body { font-family: "Microsoft YaHei", sans-serif; margin: 40px; background: linear-gradient(135deg, #f8fffe, #d3e6d2); color: #2c3e50; font-size: 16px; }
                    .header { text-align: center; margin-bottom: 30px; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                    .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0; }
                    .stat-card { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
                    .records { margin: 30px 0; background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
                    table { width: 100%; border-collapse: collapse; }
                    th, td { padding: 12px; border: 1px solid #ddd; text-align: center; font-size: 16px; }
                    th { background: linear-gradient(135deg, #7fc97f, #a8dadc); color: white; }
                    .highlight { color: #7fc97f; font-weight: bold; }
                    .signature { text-align: center; margin-top: 30px; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 10px; font-size: 1em; color: #666; }
                </style>
            </head>
            <body>
                <div class="header">
                    <h1 style="color: #7fc97f; font-size: 2.2em;">${config.studentName}的${config.planName}报告</h1>
                    <p style="font-size: 1.2em;">${config.vacationStart} 至 ${config.vacationEnd} | ${config.studentGrade}</p>
                    <p style="font-size: 1.1em;">报告生成时间：${new Date().toLocaleString('zh-CN')}</p>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <h3 class="highlight" style="font-size: 2.2em;">${totalScore}</h3>
                        <p style="font-size: 1.1em;">累计总分</p>
                    </div>
                    <div class="stat-card">
                        <h3 class="highlight" style="font-size: 2.2em;">${completedDays}</h3>
                        <p style="font-size: 1.1em;">完成天数</p>
                    </div>
                    <div class="stat-card">
                        <h3 class="highlight" style="font-size: 2.2em;">${avgScore}</h3>
                        <p style="font-size: 1.1em;">平均得分</p>
                    </div>
                    <div class="stat-card">
                        <h3 class="highlight" style="font-size: 2.2em;">${completionRate}%</h3>
                        <p style="font-size: 1.1em;">完成率</p>
                    </div>
                </div>
                
                <div class="records">
                    <h2 style="color: #7fc97f; font-size: 1.8em;">详细记录</h2>
                    <table>
                        <thead>
                            <tr><th>日期</th><th>得分</th><th>累计分数</th><th>是否达标</th></tr>
                        </thead>
                        <tbody>
                            ${dailyRecords.map((record, index) => {
                                const runningTotal = dailyRecords.slice(0, index + 1).reduce((sum, r) => sum + r.score, 0);
                                const isTarget = record.score >= config.dailyTarget;
                                return `<tr>
                                    <td>${record.date}</td>
                                    <td style="color: ${isTarget ? '#7fc97f' : '#ff6b6b'}; font-weight: bold;">${record.score}</td>
                                    <td>${runningTotal}</td>
                                    <td style="color: ${isTarget ? '#7fc97f' : '#ff6b6b'}">${isTarget ? '✅' : '❌'}</td>
                                </tr>`;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="signature">
                    <p>本报告由学习成长计划系统生成</p>
                    <p>Eva老师👩‍🏫伴步英语 提供技术支持</p>
                </div>
            </body>
            </html>
            `;
            
            const blob = new Blob([report], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `学习报告_${config.studentName || '未命名'}_${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('学习报告生成成功！', 'success');
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!importedData.config || !Array.isArray(importedData.dailyRecords)) {
                        showNotification('导入的文件格式不正确！', 'warning');
                        return;
                    }
                    
                    if (confirm('导入数据将覆盖现有数据，是否继续？')) {
                        config = importedData.config;
                        dailyRecords = importedData.dailyRecords;
                        totalScore = importedData.totalScore || 0;
                        completedDays = importedData.completedDays || 0;
                        streakDays = importedData.streakDays || 0;
                        achievements = importedData.achievements || {};
                        
                        showNotification('数据导入成功！', 'success');
                        setTimeout(() => location.reload(), 1000);
                    }
                } catch (error) {
                    showNotification('文件格式错误！', 'warning');
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
